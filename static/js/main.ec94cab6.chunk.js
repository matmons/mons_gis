(this["webpackJsonpreact-gis"]=this["webpackJsonpreact-gis"]||[]).push([[0],{195:function(e,t){},309:function(e,t,n){"use strict";n.r(t);var r=n(135),a=n(136),i=n(151),c=n(148),o=n(2),s=n(1),l=n.n(s),u=n(18),d=n.n(u),j=(n(158),n(64)),b=n(10),f=n(92),O=n.n(f),p=n(139),h=n(316),y=n(65),x=n(13),m=n(315),g=n(318),v=n(320),L=n(149),C=n(138),k=n.n(C),S=function(){for(var e="#",t=0;t<6;t++)e+="0123456789ABCDEF"[Math.floor(16*Math.random())];return e},P=function(e){if(console.log(e),"FeatureCollection"===e.type)switch(e.features[0].geometry.type){case"Point":case"MultiPoint":return"Point";case"Line":case"LineString":case"MultiLineString":return"Line";case"Polygon":case"MultiPolygon":default:return"Polygon"}else{if("Feature"!==e.type)return"Polygon";switch(e.geometry.type){case"Point":case"MultiPoint":return"Point";case"Line":case"LineString":case"MultiLineString":return"Point";case"Polygon":case"MultiPolygon":default:return"Polygon"}}},M=function(e){var t=e.addLayer,n=Object(s.useState)(!1),r=Object(b.a)(n,2),a=r[0],i=r[1],c=function(){return i(!1)},l=function(){return i(!0)},u=Object(s.useCallback)((function(e){var n=e[0],r=n.name.split("."),a=new FileReader;switch(a.onabort=function(){return console.log("Reading was aborted")},a.onerror=function(){return console.log("Reading has failed")},r[1]){case"geojson":a.onload=function(){!function(e,n){var r=JSON.parse(e),a={id:Math.floor(1e3*Math.random()).toString(),name:n,data:r,addedToMap:!1,color:S(),displayType:P(r)};t(a)}(a.result,r[0])},a.readAsText(n);break;case"zip":a.onload=function(){k()(a.result).then((function(e){console.log(e);var n={id:Math.floor(1e4*Math.random()).toString(),name:r[0],data:e,addedToMap:!1,color:S(),displayType:P(e)};t(n)}))},a.readAsArrayBuffer(n);break;default:alert("Mons GIS only supports files of type geojson or zipped shapefile")}})),d=Object(L.a)({onDrop:u}),j=d.getRootProps,f=d.getInputProps,O=d.isDragActive;return Object(o.jsxs)(o.Fragment,{children:[Object(o.jsxs)(m.a,{children:[Object(o.jsx)(p.a,{md:1,children:Object(o.jsx)(x.i,{onClick:function(){return l()}})}),Object(o.jsx)(p.a,{md:7,onClick:function(){return l()},children:Object(o.jsx)("h5",{children:"Upload"})})]}),Object(o.jsxs)(g.a,{show:a,onHide:c,children:[Object(o.jsx)(g.a.Header,{closeButton:!0,children:Object(o.jsx)(g.a.Title,{children:"Upload"})}),Object(o.jsx)(g.a.Body,{children:Object(o.jsxs)("div",Object(y.a)(Object(y.a)({},j()),{},{children:[Object(o.jsx)("input",Object(y.a)({},f())),O?Object(o.jsx)("p",{children:"Drop the files here ..."}):Object(o.jsx)("p",{children:"Drag & drop files here or click to select files"})]}))}),Object(o.jsx)(g.a.Footer,{children:Object(o.jsx)(v.a,{variant:"secondary",onClick:c,children:"Close"})})]})]})},w=function(){return Object(o.jsx)(o.Fragment,{children:Object(o.jsxs)(m.a,{className:"strictRow",children:[Object(o.jsx)(p.a,{md:2,children:Object(o.jsx)(x.e,{size:32})}),Object(o.jsx)(p.a,{md:8,children:Object(o.jsx)("h2",{children:" Mons GIS "})}),Object(o.jsx)(p.a,{md:2})]})})},F=n(42),T=n(317),I=n(321),_=n(0),B=n(146),z=function(e){var t=e.map,n=e.layer,r=e.removeLayer,a=Object(s.useState)(n.color),i=Object(b.a)(a,2),c=i[0],l=i[1],u=Object(s.useState)("visible"),d=Object(b.a)(u,2),j=d[0],f=d[1],O=function(e){"visible"===t.getLayoutProperty(e,"visibility")?(t.setLayoutProperty(e,"visibility","none"),f("none")):(t.setLayoutProperty(e,"visibility","visible"),f("visible"))};return Object(o.jsxs)(m.a,{children:[Object(o.jsx)(p.a,{md:1}),Object(o.jsx)(p.a,{md:2,children:"visible"===j?Object(o.jsx)(x.c,{onClick:function(){O(n.id)}}):Object(o.jsx)(x.d,{onClick:function(){O(n.id)}})}),Object(o.jsx)(p.a,{md:4,style:{overflow:"auto"},children:n.name?n.name:n.id}),Object(o.jsx)(T.a,{trigger:"click",placement:"right",overlay:Object(o.jsxs)(I.a,{children:[Object(o.jsx)(I.a.Title,{as:"h3",children:"Change layer color"}),Object(o.jsx)(I.a.Content,{children:Object(o.jsx)(B.a,{color:c,onChangeComplete:function(e,r){switch(l(e.hex),n.color=e.hex,n.displayType){case"Line":t.setPaintProperty(n.id,"line-color",e.hex);break;case"Polygon":default:t.setPaintProperty(n.id,"fill-color",e.hex)}}})})]}),children:Object(o.jsx)(p.a,{md:2,children:Object(o.jsx)(_.b.Provider,{value:{color:c},children:Object(o.jsx)(x.b,{})})})},"right"),Object(o.jsx)(p.a,{md:2,children:Object(o.jsx)(x.g,{onClick:function(){return r(n.id)}})})]})},D=function(e){var t=e.map,n=e.lrs,r=e.removeLayer,a=Object(s.useState)(!1),i=Object(b.a)(a,2),c=i[0],l=i[1];return Object(o.jsxs)(o.Fragment,{children:[Object(o.jsxs)(m.a,{children:[Object(o.jsx)(p.a,{md:1,children:Object(o.jsx)(x.a,{onClick:function(){return l(!c)}})}),Object(o.jsx)(p.a,{md:7,onClick:function(){return l(!c)},children:Object(o.jsx)("h5",{children:"Layers"})}),Object(o.jsx)(p.a,{md:3,children:c?Object(o.jsx)(F.a,{size:20,onClick:function(){return l(!c)}}):Object(o.jsx)(F.b,{size:20,onClick:function(){return l(!c)}})})]}),c&&n.map((function(e){return Object(o.jsx)(z,{map:t,layer:e,removeLayer:r},e.id)}))]})},R=n(319),G=n(152),H=n(150),N=n(147),A=n(94),E=n(144),U=function(e){switch(e.type){case"FeatureCollection":return A.a.apply(void 0,Object(j.a)(e.features));case"Feature":default:return e}},J=function(e){var t=e.operation,n=e.lrs,r=e.addLayer,a=Object(s.useState)({}),i=Object(b.a)(a,2),c=i[0],l=i[1],u=Object(s.useState)({}),d=Object(b.a)(u,2),j=d[0],f=d[1],O=Object(s.useState)(!1),h=Object(b.a)(O,2),y=h[0],L=h[1],C=function(){return L(!1)},k=function(){return L(!0)},P=function(e){switch(t.title){case"Buffer":var r=function(e,t){var n=Object(N.a)(e.data,t);return{id:"Buff_"+e.name,name:"Buff_"+e.name,data:n,addedToMap:!1,color:S()}}(n.find((function(e){return e.id===c[t.layerList[0]]})),j.Radius);M(e,r);break;case"Intersect":var a=function(e,t){var n=U(e.data),r=U(t.data),a=Object(H.a)(n,r);return{id:"IS_"+e.name+"_"+t.name,name:"IS_"+e.name+"_"+t.name,data:a,addedToMap:!1,color:S()}}(n.find((function(e){return e.id===c[t.layerList[0]]})),n.find((function(e){return e.id===c[t.layerList[1]]})));M(e,a);break;case"Union":var i=function(e,t){var n=Object(A.a)(e.data,t.data);return{id:"Union_"+e.name+"_"+t.name,name:"Union_"+e.name+"_"+t.name,data:n,addedToMap:!1,color:S()}}(n.find((function(e){return e.id===c[t.layerList[0]]})),n.find((function(e){return e.id===c[t.layerList[1]]})));M(e,i);break;case"Difference":var o=function(e,t){var n=U(e.data),r=U(t.data);console.log(n,r);var a=Object(G.a)(n,r);return{id:"Diff_"+e.name+"_"+t.name,name:"Diff_"+e.name+"_"+t.name,data:a,addedToMap:!1,color:S()}}(n.find((function(e){return e.id===c[t.layerList[0]]})),n.find((function(e){return e.id===c[t.layerList[1]]})));M(e,o);break;case"Cluster":var s=function(e,t){var n=Object(E.a)(e.data,{numberOfClusters:t});return{id:"Cluster_"+e.name,name:"Cluster_"+e.name,data:n,addedToMap:!1,color:S()}}(n.find((function(e){return e.id===c[t.layerList[0]]})),j["Number of Clusters"]);M(e,s);break;default:alert("Defaulted")}},M=function(e,t){t?r(t):alert("No resulting area"),e.preventDefault(),l([])};return Object(o.jsxs)(o.Fragment,{children:[Object(o.jsxs)(m.a,{children:[Object(o.jsx)(p.a,{md:2}),Object(o.jsx)(p.a,{md:6,onClick:k,children:t.title}),Object(o.jsx)(p.a,{md:3,onClick:k})]}),Object(o.jsxs)(g.a,{show:y,onHide:C,children:[Object(o.jsx)(g.a.Header,{closeButton:!0,children:Object(o.jsxs)(g.a.Title,{children:[t.title,Object(o.jsx)(T.a,{trigger:"hover",placement:"right",overlay:Object(o.jsxs)(I.a,{children:[Object(o.jsx)(I.a.Title,{as:"h3",children:"Help"}),Object(o.jsx)(I.a.Content,{children:t.description})]}),children:Object(o.jsx)(x.f,{style:{margin:4}})},"right")]})}),Object(o.jsx)(g.a.Body,{children:Object(o.jsxs)(R.a,{children:[t.layerList.map((function(e){return Object(o.jsxs)(R.a.Group,{controlId:e,children:[Object(o.jsxs)(R.a.Label,{children:["Select ",e]}),Object(o.jsxs)(R.a.Control,{as:"select",onChange:function(t){return l((function(n){return n[e]=t.target.value,c}))},required:!0,children:[Object(o.jsx)("option",{default:!0,value:null,children:"---"},"blank"),n.map((function(e){return Object(o.jsx)("option",{value:e.id,children:e.name?e.name:e.id},e.id)}))]})]},e)})),t.parameters&&Object.entries(t.parameters).map((function(e){var t=Object(b.a)(e,2),n=t[0],r=t[1];return Object(o.jsxs)(R.a.Group,{controlId:n.toString(),children:[Object(o.jsx)(R.a.Label,{children:n.toString()}),Object(o.jsx)(R.a.Control,{type:r,onChange:function(e){return f((function(t){return t[n]=e.target.value,console.log(e.target.value),t}))}})]},n)}))]})}),Object(o.jsxs)(g.a.Footer,{children:[Object(o.jsx)(v.a,{variant:"secondary",onClick:C,children:"Close"}),Object(o.jsx)(v.a,{variant:"primary",type:"submit",onClick:function(e){P(e),C()},children:"Add Layer"})]})]})]})},V=function(e,t,n,r){if("string"===typeof r)return e.filter((function(e){return e.properties[t]===r}));switch(n){case"=":return e.filter((function(e){return parseFloat(e.properties[t])===r}));case"<=":return e.filter((function(e){return parseFloat(e.properties[t])<=r}));case">=":return e.filter((function(e){return parseFloat(e.properties[t])>=r}));case"<":return e.filter((function(e){return parseFloat(e.properties[t])<r}));case">":return e.filter((function(e){return parseFloat(e.properties[t])>r}));default:return alert("Operator not found, returns empty list."),[]}},q=function(e){return e=e.replace(",","."),!isNaN(parseFloat(e))&&isFinite(e)},Z=function(e){var t={};return Object.entries(e.data.features[0].properties).map((function(e){var n=Object(b.a)(e,2),r=n[0],a=n[1];t[r]=[a]})),e.data.features.forEach((function(e){Object.entries(e.properties).forEach((function(e){var n=Object(b.a)(e,2),r=n[0],a=n[1];"string"!==typeof a||q(a)||t[r].includes(a)||t[r].push(a)}))})),t},K="Property Filter",Q="Creates a new layer with features that satisfy the user-defined rules. The allowed operators depend on the data type of the property selected.",W={number:["=",">=","<=","<",">"],string:["="]},Y=function(e){var t=e.lrs,n=e.addLayer,r=Object(s.useState)(),a=Object(b.a)(r,2),i=a[0],c=a[1],l=Object(s.useState)(),u=Object(b.a)(l,2),d=u[0],j=u[1],f=Object(s.useState)(),O=Object(b.a)(f,2),h=O[0],y=O[1],L=Object(s.useState)(),C=Object(b.a)(L,2),k=C[0],P=C[1],M=Object(s.useState)(!1),w=Object(b.a)(M,2),F=w[0],_=w[1],B=Object(s.useState)({}),z=Object(b.a)(B,2),D=z[0],G=z[1],H=function(){_(!1),c(),j(),y(),P()},N=function(){return _(!0)};return Object(o.jsxs)(o.Fragment,{children:[Object(o.jsxs)(m.a,{children:[Object(o.jsx)(p.a,{md:2}),Object(o.jsx)(p.a,{md:6,onClick:N,children:K}),Object(o.jsx)(p.a,{md:3,onClick:N})]}),Object(o.jsxs)(g.a,{show:F,onHide:H,children:[Object(o.jsx)(g.a.Header,{closeButton:!0,children:Object(o.jsxs)(g.a.Title,{children:[K,Object(o.jsx)(T.a,{trigger:"hover",placement:"right",overlay:Object(o.jsxs)(I.a,{children:[Object(o.jsx)(I.a.Title,{as:"h3",children:"Help"}),Object(o.jsx)(I.a.Content,{children:Q})]}),children:Object(o.jsx)(x.f,{style:{margin:4}})},"right")]})}),Object(o.jsx)(g.a.Body,{children:Object(o.jsxs)(R.a,{children:[Object(o.jsxs)(R.a.Group,{controlId:"layer",children:[Object(o.jsx)(R.a.Label,{children:"Select Layer"}),Object(o.jsxs)(R.a.Control,{as:"select",onChange:function(e){return function(e){if(console.log("id",e),"---"===e)c(),G();else{var n=t.find((function(t){return t.id===e})),r=Z(n);console.log(r),c(n),G(r)}}(e.target.value)},required:!0,children:[Object(o.jsx)("option",{default:!0,value:null,children:"---"},"blank"),t.map((function(e){return Object(o.jsx)("option",{value:e.id,children:e.name?e.name:e.id},e.id)}))]})]},"layer"),Object(o.jsxs)(R.a.Group,{controlId:"filter",children:[i&&Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)(R.a.Label,{children:"Select Property"}),Object(o.jsxs)(R.a.Control,{as:"select",onChange:function(e){return function(e){console.log(e);var t=e.split(",")[0],n=e.split(",")[1];q(n)?j([t,"number"]):j([t,typeof n])}(e.target.value)},children:[Object(o.jsx)("option",{default:!0,value:null,children:"---"},"blank"),Object.entries(i.data.features[0].properties).map((function(e){var t=Object(b.a)(e,2),n=t[0],r=t[1];return Object(o.jsx)("option",{value:[n,r],children:n},n)}))]},"property")]}),i&&d&&Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)(R.a.Label,{children:"Select Operator"}),Object(o.jsxs)(R.a.Control,{as:"select",onChange:function(e){return y(e.target.value)},children:[Object(o.jsx)("option",{default:!0,value:null,children:"---"},"blank"),d[1]&&W[d[1]].map((function(e){return Object(o.jsx)("option",{value:e,children:e},e)}))]},"operator")]}),i&&d&&h&&function(e){switch(e[1]){case"string":return Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)(R.a.Label,{children:"Select Value"}),Object(o.jsxs)(R.a.Control,{as:"select",onChange:function(e){return P(e.target.value)},children:[Object(o.jsx)("option",{default:!0,value:void 0,children:"---"},"blank"),D[e[0]].map((function(e){return Object(o.jsx)("option",{value:e,children:e},e)}))]},"value")]});case"number":default:return Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)(R.a.Label,{children:"Select Value"}),Object(o.jsx)(R.a.Control,{type:e[1],onChange:function(e){return P(e.target.value)}},"value")]})}}(d)]})]})}),Object(o.jsxs)(g.a.Footer,{children:[Object(o.jsx)(v.a,{variant:"secondary",onClick:H,children:"Close"}),Object(o.jsx)(v.a,{variant:"primary",type:"submit",onClick:function(e){!function(e){var t=V(i.data.features,d[0],h,k);console.log("ffl",t);var r={type:"FeatureCollection",features:t},a={id:i.name+"_filtered",name:i.name+"_filtered",data:r,addedToMap:!1,color:S()};n(a),e.preventDefault(),c(void 0)}(e),H()},children:"Add Layer"})]})]})]})},X=[{id:1,title:"Buffer",layerList:["Layer 1"],parameters:{Radius:"number"},description:"The Buffer Operation takes the features from a source vector layer and creates a buffer area of a specified distance around, storing the result on a Result Layer."},{id:2,title:"Intersect",layerList:["Layer 1","Layer 2"],parameters:{},description:"The Intersect Operation calculates the geometric intersection of two layers."},{id:3,title:"Union",layerList:["Layer 1","Layer 2"],parameters:{},description:"The Union Operation combines the features from two layers into a single, composite layer."},{id:5,title:"Clustering",layerList:["Layer 1"],parameters:{"Number of Clusters":"number"},description:"The Clustering Operation takes a collection of points and returns the resulting K means clusters. The number of clusters required depends on your applicaiton."}],$=function(e){var t=e.lrs,n=e.addLayer,r=Object(s.useState)(!1),a=Object(b.a)(r,2),i=a[0],c=a[1];return Object(o.jsxs)(o.Fragment,{children:[Object(o.jsxs)(m.a,{children:[Object(o.jsx)(p.a,{md:1,children:Object(o.jsx)(x.h,{})}),Object(o.jsx)(p.a,{md:7,onClick:function(){return c(!i)},children:Object(o.jsx)("h5",{children:"Operations"})}),Object(o.jsx)(p.a,{md:3,children:i?Object(o.jsx)(F.a,{size:20,onClick:function(){return c(!i)}}):Object(o.jsx)(F.b,{size:20,onClick:function(){return c(!i)}})})]}),i&&X.map((function(e){return Object(o.jsx)(J,{operation:e,lrs:t,addLayer:n},e.id)})),i&&Object(o.jsx)(Y,{lrs:t,addLayer:n})]})},ee={position:"absolute",top:0,left:0,width:"100%",background:"white",color:"black",padding:"1em",margin:10,zIndex:"1"},te=function(e){var t=e.map,n=e.lrs,r=e.addLayer,a=e.removeLayer;return Object(o.jsx)(o.Fragment,{children:Object(o.jsx)(p.a,{md:3,children:Object(o.jsxs)(h.a,{style:ee,children:[Object(o.jsx)(w,{}),Object(o.jsx)($,{lrs:n,addLayer:r}),Object(o.jsx)(D,{map:t,lrs:n,removeLayer:a}),Object(o.jsx)(M,{addLayer:r})]})})})},ne=function(e){var t={id:e.id,type:"symbol",source:e.id,layout:{visibility:"visible","icon-size":10},paint:{"icon-color":e.color}},n={id:e.id,type:"line",source:e.id,layout:{visibility:"visible"},paint:{"line-color":e.color,"line-width":.6}},r={id:e.id,type:"fill",source:e.id,layout:{visibility:"visible"},paint:{"fill-color":e.color,"fill-opacity":.6}};if("FeatureCollection"===e.data.type)switch(console.log("FC construct layer",e),e.data.features[0].geometry.type){case"Point":case"MultiPoint":return console.log("point case"),t;case"Line":case"LineString":case"MultiLineString":return n;case"Polygon":case"MultiPolygon":default:return r}else{if("Feature"!==e.data.type)return r;switch(console.log("Feature construct layer",e),e.data.geometry.type){case"Point":case"MultiPoint":return t;case"Line":case"LineString":case"MultiLineString":return n;case"Polygon":case"MultiPolygon":default:return r}}},re={position:"absolute",top:0,bottom:0,right:0,left:0,zIndex:"-1"},ae={position:"absolute",top:0,right:0,margin:10,padding:10,background:"white",zIndex:"1",display:"flex"},ie=[{id:"streets-v11",name:"Streets"},{id:"light-v10",name:"Light"},{id:"dark-v10",name:"Dark"},{id:"satellite-v9",name:"Satellite"}];O.a.accessToken="pk.eyJ1IjoibW9uc2VtIiwiYSI6ImNraG4yc2syaTBiZ24ydGwxOTg0ZnJiMG0ifQ.B3OT7lkRhmt4w5lTa9fJ2w";var ce=function(){var e=Object(s.useState)(null),t=Object(b.a)(e,2),n=t[0],r=t[1],a=Object(s.useState)("streets-v11"),i=Object(b.a)(a,2),c=i[0],l=i[1],u=Object(s.useState)([]),d=Object(b.a)(u,2),f=d[0],p=d[1],h=Object(s.useRef)(null);Object(s.useEffect)((function(){n||function(e){var t=e.setMap,n=e.mapContainer,r=new O.a.Map({container:n.current,style:"mapbox://styles/mapbox/streets-v11",center:[10.3856,63.4292],zoom:12.2});r.on("load",(function(){t(r),r.resize()}))}({setMap:r,mapContainer:h}),n&&n.setStyle("mapbox://styles/mapbox/"+c)}),[c,n]),Object(s.useEffect)((function(){n&&f&&function(e,t){t.filter((function(e){return!e.addedToMap})).forEach((function(t){e.addSource(t.id,{type:"geojson",data:t.data}),e.addLayer(ne(t)),t.addedToMap=!0}))}(n,f)}),[f,n]);return Object(o.jsxs)("div",{children:[Object(o.jsx)(te,{map:n,lrs:f,addLayer:function(e){p((function(t){return[].concat(Object(j.a)(t),[e])}))},removeLayer:function(e){n.removeLayer(e),n.removeSource(e),p((function(t){return t.filter((function(t){return t.id!==e}))}))},toggleVisibility:function(e){"visible"===n.getLayoutProperty(e,"visibility")?n.setLayoutProperty(e,"visibility","none"):n.setLayoutProperty(e,"visibility","visible")}}),Object(o.jsx)("div",{style:ae,children:ie.map((function(e){return Object(o.jsxs)("div",{style:{margin:4},children:[Object(o.jsx)("input",{id:e.id,type:"radio",name:"rtoggle",value:e.id,onClick:function(){l(e.id),p([])},defaultChecked:e.id===c}),Object(o.jsx)("label",{style:{margin:2},children:e.name})]},e.id)}))}),Object(o.jsx)("div",{ref:function(e){return h.current=e},style:re})]})};var oe=function(){return Object(o.jsx)("div",{children:Object(o.jsx)(ce,{})})},se=function(e){Object(i.a)(n,e);var t=Object(c.a)(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(a.a)(n,[{key:"render",value:function(){return Object(o.jsx)("div",{children:Object(o.jsx)(oe,{})})}}]),n}(l.a.Component);d.a.render(Object(o.jsx)(se,{}),document.getElementById("app"))}},[[309,1,2]]]);
//# sourceMappingURL=main.ec94cab6.chunk.js.map